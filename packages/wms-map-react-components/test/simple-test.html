<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WMS Map Modal - Mock Data æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .test-button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: white;
            transition: all 0.2s ease;
        }
        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .simple { background-color: #3b82f6; }
        .complex { background-color: #22c55e; }
        .large { background-color: #f59e0b; }
        .info-box {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        .stats-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ WMS Map Modal - Mock Data æ¸¬è©¦</h1>
        
        <div class="info-box">
            <h3>ğŸ’¡ æ¸¬è©¦èªªæ˜</h3>
            <p>é€™å€‹é é¢å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>initialNodes</code> prop ä¾†è¼‰å…¥ Mock è³‡æ–™åˆ° WmsMapModal ä¸­ã€‚</p>
            <p>ç”±æ–¼é€™æ˜¯éœæ…‹ HTML é é¢ï¼Œå¯¦éš›çš„ React çµ„ä»¶æ¸¬è©¦éœ€è¦åœ¨ React é–‹ç™¼ç’°å¢ƒä¸­é€²è¡Œã€‚</p>
        </div>

        <div class="button-group">
            <button class="test-button simple" onclick="showTestExample('simple')">
                ç°¡å–®æ¸¬è©¦è³‡æ–™
                <br><small>(1å€‹èƒŒæ™¯ + 2å€‹å€åŸŸ)</small>
            </button>
            <button class="test-button complex" onclick="showTestExample('complex')">
                å®Œæ•´å€‰åº«è³‡æ–™
                <br><small>(2å€‹èƒŒæ™¯ + 8å€‹å€åŸŸ)</small>
            </button>
            <button class="test-button large" onclick="showTestExample('large')">
                å¤§é‡æ¸¬è©¦è³‡æ–™
                <br><small>(5å€‹èƒŒæ™¯ + 30å€‹å€åŸŸ)</small>
            </button>
        </div>

        <div id="test-result" style="display: none;">
            <div class="stats-box">
                <h3>ğŸ“Š è³‡æ–™çµ±è¨ˆ</h3>
                <div id="stats-content"></div>
            </div>
            
            <h3>ğŸ”§ ä½¿ç”¨æ–¹å¼</h3>
            <pre id="code-example"></pre>
            
            <h3>ğŸ“„ åŸå§‹ Mock è³‡æ–™</h3>
            <pre id="mock-data"></pre>
            
            <h3>ğŸ”„ è½‰æ›å¾Œçš„ React Flow ç¯€é»</h3>
            <pre id="transformed-nodes"></pre>
        </div>
    </div>

    <script>
        // æ¨¡æ“¬ Mock è³‡æ–™ (ç°¡åŒ–ç‰ˆæœ¬)
        const mockData = {
            simple: {
                id: 'simple-test-map',
                backgrounds: [
                    { id: 'simple-bg-1', filename: 'simple-background.png', x: 100, y: 50 }
                ],
                ranges: [
                    { id: 'simple-rect-1', type: 'RECTANGLE', color: '#3b82f6', x: 150, y: 100, width: 100, height: 80, text: 'æ¸¬è©¦çŸ©å½¢' },
                    { id: 'simple-poly-1', type: 'POLYGON', color: '#ef4444', points: [{ x: 300, y: 120 }, { x: 350, y: 120 }, { x: 325, y: 170 }], text: 'æ¸¬è©¦ä¸‰è§’å½¢' }
                ]
            },
            complex: {
                id: 'warehouse-map-001',
                backgrounds: [
                    { id: 'bg-warehouse-floor-1', filename: 'warehouse-floor-plan.png', x: 50, y: 30 },
                    { id: 'bg-warehouse-zones', filename: 'warehouse-zones.jpg', x: 400, y: 200 }
                ],
                ranges: [
                    { id: 'range-receiving-area', type: 'RECTANGLE', color: '#22c55e', x: 100, y: 80, width: 150, height: 100, text: 'æ”¶è²¨å€ A' },
                    { id: 'range-storage-b', type: 'RECTANGLE', color: '#3b82f6', x: 300, y: 120, width: 200, height: 80, text: 'å„²å­˜å€ B' },
                    { id: 'range-shipping-area', type: 'RECTANGLE', color: '#f59e0b', x: 150, y: 250, width: 180, height: 90, text: 'å‡ºè²¨å€' },
                    { id: 'range-hazmat-zone', type: 'POLYGON', color: '#ef4444', points: [{ x: 450, y: 100 }, { x: 520, y: 90 }, { x: 540, y: 140 }], text: 'å±éšªå“å€' }
                ]
            },
            large: {
                id: 'performance-test-map',
                backgrounds: Array.from({ length: 5 }, (_, i) => ({
                    id: `bg-${i + 1}`,
                    filename: `background-${i + 1}.png`,
                    x: 100 + i * 200,
                    y: 50 + i * 30
                })),
                ranges: Array.from({ length: 30 }, (_, i) => ({
                    id: `range-${i + 1}`,
                    type: i % 3 === 0 ? 'POLYGON' : 'RECTANGLE',
                    color: ['#3b82f6', '#ef4444', '#22c55e', '#f59e0b', '#8b5cf6'][i % 5],
                    x: 100 + (i % 5) * 120,
                    y: 100 + Math.floor(i / 5) * 100,
                    width: 80,
                    height: 60,
                    text: `å€åŸŸ ${i + 1}`
                }))
            }
        };

        function showTestExample(type) {
            const data = mockData[type];
            const resultDiv = document.getElementById('test-result');
            
            // è¨ˆç®—çµ±è¨ˆè³‡è¨Š
            const bgCount = data.backgrounds.length;
            const rectCount = data.ranges.filter(r => r.type === 'RECTANGLE').length;
            const polyCount = data.ranges.filter(r => r.type === 'POLYGON').length;
            const totalNodes = bgCount + rectCount + polyCount;
            
            // æ›´æ–°çµ±è¨ˆè³‡è¨Š
            document.getElementById('stats-content').innerHTML = `
                <p><strong>æ¸¬è©¦é¡å‹:</strong> ${type === 'simple' ? 'ç°¡å–®æ¸¬è©¦' : type === 'complex' ? 'å®Œæ•´å€‰åº«' : 'å¤§é‡æ¸¬è©¦'}è³‡æ–™</p>
                <p><strong>ç¸½ç¯€é»æ•¸:</strong> ${totalNodes}</p>
                <p><strong>èƒŒæ™¯åœ–ç‰‡:</strong> ${bgCount}</p>
                <p><strong>çŸ©å½¢å€åŸŸ:</strong> ${rectCount}</p>
                <p><strong>å¤šé‚Šå½¢å€åŸŸ:</strong> ${polyCount}</p>
            `;
            
            // æ›´æ–°ä½¿ç”¨ç¯„ä¾‹
            document.getElementById('code-example').textContent = `
import React, { useState } from 'react';
import { WmsMapModal, transformApiDataToNodes, ${type}MapData } from '@rytass/wms-map-react-components';

const MyComponent = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [nodes, setNodes] = useState([]);

  const loadTestData = () => {
    // è½‰æ› API è³‡æ–™ç‚º React Flow ç¯€é»
    const transformedNodes = transformApiDataToNodes(${type}MapData);
    setNodes(transformedNodes);
    setIsOpen(true);
  };

  return (
    <>
      <button onClick={loadTestData}>è¼‰å…¥${type === 'simple' ? 'ç°¡å–®' : type === 'complex' ? 'è¤‡é›œ' : 'å¤§é‡'}æ¸¬è©¦è³‡æ–™</button>
      
      <WmsMapModal
        open={isOpen}
        onClose={() => setIsOpen(false)}
        viewMode="VIEW"
        colorPalette={['#3b82f6', '#ef4444', '#22c55e', '#f59e0b', '#8b5cf6']}
        initialNodes={nodes}  // â† é—œéµï¼šä½¿ç”¨ initialNodes prop
        initialEdges={[]}
        onNodeClick={(nodeInfo) => console.log('é»æ“Š:', nodeInfo)}
      />
    </>
  );
};`;
            
            // æ›´æ–° Mock è³‡æ–™
            document.getElementById('mock-data').textContent = JSON.stringify(data, null, 2);
            
            // æ¨¡æ“¬è½‰æ›å¾Œçš„ç¯€é»è³‡æ–™
            const transformedNodes = transformMockData(data);
            document.getElementById('transformed-nodes').textContent = JSON.stringify(transformedNodes, null, 2);
            
            // é¡¯ç¤ºçµæœ
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // ç°¡åŒ–çš„è³‡æ–™è½‰æ›å‡½æ•¸ (åƒ…ç”¨æ–¼ç¤ºä¾‹)
        function transformMockData(mapData) {
            const nodes = [];
            let zIndex = 1;

            // è½‰æ›èƒŒæ™¯
            mapData.backgrounds.forEach(bg => {
                nodes.push({
                    id: bg.id,
                    type: 'imageNode',
                    position: { x: bg.x, y: bg.y },
                    data: {
                        imageUrl: `https://via.placeholder.com/200x150/4A90E2/ffffff?text=${encodeURIComponent(bg.filename)}`,
                        fileName: bg.filename,
                        width: 200,
                        height: 150
                    },
                    zIndex: zIndex++
                });
            });

            // è½‰æ›ç¯„åœ
            mapData.ranges.forEach(range => {
                if (range.type === 'RECTANGLE') {
                    nodes.push({
                        id: range.id,
                        type: 'rectangleNode',
                        position: { x: range.x, y: range.y },
                        data: {
                            width: range.width,
                            height: range.height,
                            color: range.color,
                            label: range.text || ''
                        },
                        zIndex: zIndex++
                    });
                } else if (range.type === 'POLYGON') {
                    const centerX = range.points.reduce((sum, p) => sum + p.x, 0) / range.points.length;
                    const centerY = range.points.reduce((sum, p) => sum + p.y, 0) / range.points.length;
                    
                    nodes.push({
                        id: range.id,
                        type: 'pathNode',
                        position: { x: centerX, y: centerY },
                        data: {
                            points: range.points.map(p => ({ x: p.x - centerX, y: p.y - centerY })),
                            color: range.color,
                            label: range.text || ''
                        },
                        zIndex: zIndex++
                    });
                }
            });

            return nodes;
        }
    </script>
</body>
</html>